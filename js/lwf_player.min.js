var LwfPlayer;!function(e){"use strict";!function(e){e[e.useCanvasRenderer=0]="useCanvasRenderer",e[e.useWebkitCSSRenderer=1]="useWebkitCSSRenderer",e[e.useWebGLRenderer=2]="useWebGLRenderer"}(e.RendererName||(e.RendererName={}));e.RendererName}(LwfPlayer||(LwfPlayer={}));var LwfPlayer;!function(e){"use strict";var t=function(){function t(){var t=this;this.autoSelectRenderer=function(){for(var r=document.createElement("canvas"),n=["webgl","experimental-webgl"],i=0;i<n.length;i++)if(r.getContext(n[i])){t._renderer=e.RendererName[2];break}/iP(ad|hone|od).*OS 4/.test(e.Util.ua)?t._renderer=e.RendererName[1]:/Android 2\.1/.test(e.Util.ua)||/Android 2\.3\.[5-7]/.test(e.Util.ua)?t._renderer=e.RendererName[1]:/Android 4/.test(e.Util.ua)&&(t._renderer=/Chrome/.test(e.Util.ua)?e.RendererName[0]:e.RendererName[1]),e.Util.isEmpty(t._renderer)&&(t._renderer=e.RendererName[0])},this.autoSelectRenderer()}return Object.defineProperty(t.prototype,"renderer",{get:function(){return this._renderer},set:function(t){if(e.Util.isEmpty(t))return void this.autoSelectRenderer();switch(t){case e.RendererName[0]:case e.RendererName[1]:case e.RendererName[2]:this._renderer=t;break;default:throw new Error("unsupported renderer:"+t)}this.autoSelectRenderer()},enumerable:!0,configurable:!0}),t}();e.RendererSelector=t}(LwfPlayer||(LwfPlayer={}));var LwfPlayer;!function(e){"use strict";var t=function(){function t(){}return t.ua=global.navigator.userAgent,t.isiOS=/iP(ad|hone|od)/.test(t.ua),t.isAndroid=/Android/.test(t.ua),t.isSp=t.isiOS||t.isAndroid,t.isChrome=/Chrome/.test(t.ua),t.isTouchEventEnabled=t.isSp,t.useWebWorker=!t.isAndroid||t.isChrome,t.isPreventDefaultEnabled=t.isiOS||/Android *(4|3)\..*/.test(t.ua),t.forceSettingForAndroid=function(r,n){r.use3D=!1,r.worker&&(r.worker=t.useWebWorker),/ (SC-0|Galaxy Nexus|SH-0)/.test(t.ua)&&n===e.RendererName[1]&&(r.quirkyClearRect=!0)},t.getOpacity=function(r){return r===e.RendererName[1]&&/Android 2\.3\.[5-7]/.test(t.ua)&&/SH/.test(t.ua)?"0.9999":null},t.getStageWidth=function(){return global.innerWidth>global.screen.width?global.screen.width:global.innerWidth},t.getStageHeight=function(){return global.innerHeight>global.screen.height?global.screen.height:global.innerHeight},t.isEmpty=function(e){if(void 0===e||null===e)return!0;if("string"==typeof e||e instanceof String||e instanceof Array)return 0===e.length;if(e instanceof Function||isFinite(e))return!1;for(var t in e)if(e.hasOwnProperty(t))return!1;return!(e instanceof Boolean)},t.isNotEmpty=function(e){return!t.isEmpty(e)},t}();if(e.Util=t,t.isEmpty(global.performance)&&(global.performance={}),global.performance.now=global.performance.now||global.performance.webkitNow||global.performance.mozNow||global.performance.oNow||global.performance.msNow||Date.now,global.requestAnimationFrame=global.requestAnimationFrame||global.webkitRequestAnimationFrame||global.mozRequestAnimationFrame||global.oRequestAnimationFrame||global.msRequestAnimationFrame,t.isEmpty(global.requestAnimationFrame)||/iP(ad|hone|od).*OS 6/.test(t.ua)){var r=1e3/60,n=global.performance.now();global.requestAnimationFrame=function(e){var t=global.performance.now(),i=t-n,a=r-(i>r?i%r:i);return setTimeout(function(){n=global.performance.now(),e()},a)}}t.isAndroid&&(t.isChrome||/ SC-0/.test(t.ua))&&document.body.addEventListener("touchstart",function(){})}(LwfPlayer||(LwfPlayer={}));var LwfPlayer;!function(e){"use strict";var t=function(){function t(t){var r=this;this._player=null,this._targetStage=null,this._screenStage=null,this._stageScale=1,this._devicePixelRatio=global._devicePixelRatio,this._debugInfo=null,this._from=global.performance.now(),this._currentFPS=0,this._execCount=0,this._stageWidth=0,this._stageHeight=0,this._stageStyleWidth=0,this._stageStyleHeight=0,this.changeStageSize=function(t,n){var i=e.Util.getStageWidth(),a=e.Util.getStageHeight();t>i&&(t=i),n>a&&(n=a),r._player.lwfSettings.fitForWidth?r.fitForWidth(t,n):r._player.lwfSettings.fitForHeight?r.fitForHeight(t,n):r.fitToScreen(t,n),r._screenStage.style.width=r._eventReceiveStage.style.width=r._stageStyleWidth+"px",r._screenStage.style.height=r._eventReceiveStage.style.height=r._stageStyleHeight+"px",r._screenStage.setAttribute("width",r._stageWidth+""),r._screenStage.setAttribute("height",r._stageHeight+"")},this.fitForWidth=function(e,t){r._stageStyleWidth=Math.round(e),r._stageStyleHeight=Math.round(e*t/e),r.setStageWidthAndHeight(),r._stageScale=r._stageStyleWidth/r._stageWidth},this.fitForHeight=function(e,t){r._stageStyleWidth=Math.round(t*e/t),r._stageStyleHeight=Math.round(t),r.setStageWidthAndHeight(),r._stageScale=r._stageStyleHeight/r._stageHeight},this.fitToScreen=function(t,n){var i=e.Util.getStageWidth(),a=e.Util.getStageHeight(),o=t/n,s=i/a;s>o?(r._stageStyleWidth=t*(a/n),r._stageStyleHeight=a,r.setStageWidthAndHeight(),r._stageScale=r._stageStyleWidth/r._stageWidth):(r._stageStyleWidth=i,r._stageStyleHeight=n*(i/t),r.setStageWidthAndHeight(),r._stageScale=r._stageStyleHeight/r._stageHeight)},this.setStageWidthAndHeight=function(){r._stageWidth=Math.floor(r._stageStyleWidth*r._devicePixelRatio),r._stageHeight=Math.floor(r._stageStyleHeight*r._devicePixelRatio)},this.addEventListeners=function(){e.Util.isTouchEventEnabled?(r._eventReceiveStage.addEventListener("touchmove",r._player.onMove,!1),r._eventReceiveStage.addEventListener("touchstart",r._player.onPress,!1),r._eventReceiveStage.addEventListener("touchend",r._player.onRelease,!1)):(r._eventReceiveStage.addEventListener("mousedown",r._player.onPress,!1),r._eventReceiveStage.addEventListener("mousemove",r._player.onMove,!1),r._eventReceiveStage.addEventListener("mouseup",r._player.onRelease,!1))},this.removeEventListeners=function(){e.Util.isTouchEventEnabled?(r._eventReceiveStage.removeEventListener("touchstart",r._player.onPress,!1),r._eventReceiveStage.removeEventListener("touchmove",r._player.onMove,!1),r._eventReceiveStage.removeEventListener("touchend",r._player.onRelease,!1)):(r._eventReceiveStage.removeEventListener("mousedown",r._player.onPress,!1),r._eventReceiveStage.removeEventListener("mousemove",r._player.onMove,!1),r._eventReceiveStage.removeEventListener("mouseup",r._player.onRelease,!1))},this.createScreenStage=function(t){r._screenStage=document.createElement(t.renderer===e.RendererName[0]||t.renderer===e.RendererName[2]?"canvas":"div"),e.Util.isEmpty(r._player.lwfSettings.pos)&&r._player.lwfSettings.initPos();var n=r._player.lwfSettings.pos;r._screenStage.style.position=n.position,r._screenStage.style.top=n.top+"px",r._screenStage.style.left=n.left+"px",r._screenStage.style.zIndex=r._targetStage.style.zIndex+1,r._screenStage.style.opacity=e.Util.getOpacity(t.renderer),r._targetStage.appendChild(r._screenStage)},this.createEventReceiveStage=function(){var e=r._player.lwfSettings.pos;r._eventReceiveStage=document.createElement("div"),r._eventReceiveStage.style.position="absolute",r._eventReceiveStage.style.top=e.top+"px",r._eventReceiveStage.style.left=e.left+"px",r._eventReceiveStage.style.zIndex=r._screenStage.style.zIndex+1,r._targetStage.appendChild(r._eventReceiveStage)},this.viewDebugInfo=function(){if(e.Util.isEmpty(r._debugInfo)&&(r._debugInfo=document.createElement("div"),r._debugInfo.style.position="absolute",r._debugInfo.style.top="0px",r._debugInfo.style.left="0px",r._debugInfo.style.zIndex="9999",r._debugInfo.style.color="red",r._debugInfo.id="__lwfPlayerDebugInfoID",r._targetStage.appendChild(r._debugInfo)),r._execCount%60===0){var t=global.performance.now();r._currentFPS=Math.round(6e4/(t-r._from)),r._from=t,r._execCount=0}var n=r._player.coordinator.x,i=r._player.coordinator.y,a=r._player.rendererSelector.renderer.substring(3);a=a.substring(0,a.lastIndexOf("Renderer")),r._execCount++,r._debugInfo.innerHTML=a+" "+r._currentFPS+"fps X:"+n+" Y:"+i+"<br>sw:"+r._stageStyleWidth+" sh:"+r._stageStyleHeight+" w:"+r._stageWidth+" h:"+r._stageHeight+" s:"+r._stageScale+" dpr:"+r.devicePixelRatio},this._player=t,this._targetStage=this._player.playerSettings.targetStage,("static"===this._targetStage.style.position||e.Util.isEmpty(this._targetStage.style.position))&&(this._targetStage.style.position="relative"),this._player.rendererSelector.renderer===e.RendererName[1]&&(this._devicePixelRatio=1),this._player.rendererSelector.renderer===e.RendererName[2]&&/ F-/.test(e.Util.ua)&&(this._devicePixelRatio=2),e.Util.isEmpty(this._devicePixelRatio)&&(this._devicePixelRatio=1)}return Object.defineProperty(t.prototype,"devicePixelRatio",{get:function(){return this._devicePixelRatio},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"stageScale",{get:function(){return this._stageScale},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"screenStage",{get:function(){return this._screenStage},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"screenStageWidth",{get:function(){return+this._screenStage.getAttribute("width")},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"screenStageHeight",{get:function(){return+this._screenStage.getAttribute("height")},enumerable:!0,configurable:!0}),t}();e.StageContractor=t;var r=function(){function e(){}return e}();e.Position=r}(LwfPlayer||(LwfPlayer={}));var LwfPlayer;!function(e){var t=function(){function t(t){var r=this;this._x=0,this._y=0,this._isPreventDefaultEnabled=e.Util.isPreventDefaultEnabled,this.setCoordinate=function(t){r._isPreventDefaultEnabled&&t.preventDefault();var n=r._stageContractor.screenStage.getBoundingClientRect(),i=r._stageContractor.stageScale;e.Util.isTouchEventEnabled?(r._x=t.touches[0].pageX,r._y=t.touches[0].pageY):(r._x=t.clientX,r._y=t.clientY),r._x-=n.left,r._y-=n.top,e.Util.isSp&&(r._x-=global.scrollX,r._y-=global.scrollY),r._x/=i,r._y/=i},this._stageContractor=t}return Object.defineProperty(t.prototype,"preventDefaultEnabled",{set:function(e){this._isPreventDefaultEnabled=e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"x",{get:function(){return this._x},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"y",{get:function(){return this._y},enumerable:!0,configurable:!0}),t}();e.Coordinator=t}(LwfPlayer||(LwfPlayer={}));var LwfPlayer;!function(e){"use strict";var t=function(){function t(){}return t.getLwfPath=function(e){var t=e;return e.indexOf("/")>=0&&(t=e.substring(e.lastIndexOf("/")+1)),e+"/_/"+t+".lwf"},t.setLoader=function(e,t){t.privateData.lwfLoader=e},t.prepareChildLwfSettings=function(t,r,n,i,a){var o=new e.LwfSettings;for(var s in a)a.hasOwnProperty(s)&&(o[s]=a[s]);return e.Util.isNotEmpty(n)?o.imageMap=e.LwfSettings.getImageMapper(n):i.hasOwnProperty("imageMap")&&(o.imageMap=e.LwfSettings.getImageMapper(i.imageMap)),e.Util.isNotEmpty(i)&&(o.privateData=i),o.lwf=o.getLwfPath(r),o.stage=a.stage,o.fitForHeight=!1,o.fitForWidth=!1,o.parentLWF=t,o.active=!1,o},t}();e.LwfLoader=t}(LwfPlayer||(LwfPlayer={}));var LwfPlayer;!function(e){"use strict";var t=function(){function t(){var r=this;this.pos={},this.validationLwfSettings=function(){if(e.Util.isEmpty(r.lwf))throw new Error("lwf property is require.")},this.initPos=function(){r.pos={top:0,left:0,position:"absolute"}},this.prepareLwfSettings=function(n){e.Util.isEmpty(r.privateData)&&(r.privateData={}),e.Util.isEmpty(r.useBackgroundColor)&&(r.useBackgroundColor=!0),r.stage=n.stageContractor.screenStage,r.imageMap=t.getImageMapper(r.imageMap),e.Util.isAndroid&&e.Util.forceSettingForAndroid(r,n.rendererSelector.renderer),r.onload=n.onLoad,e.LwfLoader.setLoader(n,r)},this.getLwfPath=function(t){if(e.Util.isNotEmpty(r.lwfMap)){if(r.lwfMap instanceof Function)return r.lwfMap(t);var n=r.lwfMap[t];return/\.lwf$/.test(n)||(n+=".lwf"),n}return e.LwfLoader.getLwfPath(t)}}return t.getImageMapper=function(e){return e instanceof Function?e:function(t){return e&&e.hasOwnProperty(t)?e[t]:t}},t}();e.LwfSettings=t}(LwfPlayer||(LwfPlayer={}));var LwfPlayer;!function(e){var t=function(){function t(){var t=this;this.validationPlayerSettings=function(){if(e.Util.isEmpty(t.targetStage))throw new Error("targetStage property is need HTMLElement")}}return Object.defineProperty(t.prototype,"renderer",{get:function(){return this._renderer},set:function(e){this._renderer=e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"isDebugMode",{get:function(){return this._isDebugMode},set:function(e){this._isDebugMode=e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"targetStage",{get:function(){return this._targetStage},set:function(e){this._targetStage=e},enumerable:!0,configurable:!0}),t}();e.PlayerSettings=t}(LwfPlayer||(LwfPlayer={}));var LwfPlayer;!function(e){"use strict";var t=function(){function t(t,r){var n=this;this._lwf=null,this._cache=null,this._playerSettings=null,this._lwfSettings=new e.LwfSettings,this._stageContractor=null,this._coordinator=null,this._rendererSelector=new e.RendererSelector,this._inputQueue=[],this._fromTime=global.performance.now(),this._pausing=!1,this._goPlayBack=!1,this._destroyed=!1,this._goRestart=!1,this.play=function(){n.initStage(),n.initLwf(),n._lwfSettings.prepareLwfSettings(n),n._cache.loadLWF(n._lwfSettings)},this.pause=function(){n._pausing=!0},this.resume=function(){n._pausing=!1},this.playBack=function(){n._goPlayBack=!0},this.reStart=function(e){n._goRestart=!0,n.setSettingsAndValidation(n._playerSettings,e),n._lwfSettings.prepareLwfSettings(n),n._cache.loadLWF(n._lwfSettings)},this.destroy=function(){n._destroyed=!0},this.handleLoadError=function(){n._lwfSettings.handler&&n._lwfSettings.handler.loadError instanceof Function&&n._lwfSettings.handler.loadError(n._lwfSettings.error),console.error("[LWF] load error: %o",n._lwfSettings.error)},this.handleException=function(e){n._lwfSettings.handler&&n._lwfSettings.handler.exception instanceof Function&&n._lwfSettings.handler.exception(e),console.error("[LWF] load Exception: %o",e)},this.exec=function(){try{if(n._goRestart)return void(n._goRestart=!1);if(n._destroyed)return void n.destroyLwf();if(n._goPlayBack&&(n._goPlayBack=!1,n._lwf.init()),e.Util.isNotEmpty(n._lwf)&&!n._pausing){for(var t=0;t<n._inputQueue.length;t++)n._inputQueue[t].apply(n);n._stageContractor.changeStageSize(n._lwf.width,n._lwf.height),n.renderLwf()}n._inputQueue=[],global.requestAnimationFrame(function(){n.exec()})}catch(r){n.handleException(r)}},this.initStage=function(){n._stageContractor=new e.StageContractor(n),n._stageContractor.createScreenStage(n._rendererSelector),n._stageContractor.createEventReceiveStage(),n._stageContractor.addEventListeners(),n._coordinator=new e.Coordinator(n._stageContractor)},this.initLwf=function(){try{switch(n._rendererSelector.renderer){case e.RendererName[0]:global.LWF.useCanvasRenderer();break;case e.RendererName[1]:global.LWF.useWebkitCSSRenderer();break;case e.RendererName[2]:global.LWF.useWebGLRenderer();break;default:throw new Error("not supported renderer")}n._cache=global.LWF.ResourceCache.get()}catch(t){n.handleException(t)}},this.renderLwf=function(){var t=n._stageContractor.screenStageWidth,r=n._stageContractor.screenStageHeight,i=global.performance.now(),a=(i-n._fromTime)/1e3;n._fromTime=i,n._lwf.property.clear(),n._lwfSettings.fitForWidth?n._lwf.fitForWidth(t,r):n._lwf.fitForHeight(t,r),n.rendererSelector.renderer===e.RendererName[1]&&n._lwf.setTextScale(n.stageContractor.devicePixelRatio),n._lwf.property.moveTo(0,0),n._lwf.exec(a),n._lwf.render(),n._playerSettings.isDebugMode&&n._stageContractor.viewDebugInfo()},this.destroyLwf=function(){e.Util.isNotEmpty(n._lwf)&&(n._stageContractor.removeEventListeners(),n._lwf.destroy(),n._cache=null,n._lwf=null,console.log("destroy LWF.")),console.log("LWF is destroyed.")},this.setSettingsAndValidation=function(t,r){if(e.Util.isEmpty(t)||e.Util.isEmpty(r))throw new Error("not enough argument.");if(!(t instanceof e.PlayerSettings&&r instanceof e.LwfSettings))throw new TypeError("require PlayerSettings instance and LwfSettings instance. ex sample/sample1/index.html");n._playerSettings=t,n._playerSettings.validationPlayerSettings(),n._lwfSettings=r,n._lwfSettings.validationLwfSettings()},this.inputPoint=function(e){n._coordinator.setCoordinate(e),n._lwf.inputPoint(n._coordinator.x,n._coordinator.y)},this.inputPress=function(e){n.inputPoint(e),n._lwf.inputPress()},this.onMove=function(e){n._inputQueue.push(function(){this.inputPoint(e)})},this.onPress=function(e){n._inputQueue.push(function(){this.inputPress(e)})},this.onRelease=function(){n._inputQueue.push(function(){this._lwf.inputRelease()})},this.onLoad=function(t){e.Util.isNotEmpty(t)?(n._lwf=t,n.exec()):n.handleLoadError()},this.loadLWF=function(t,r,i,a,o){var s=e.LwfLoader.prepareChildLwfSettings(t,r,i,a,n._lwfSettings);s.onload=function(t){return e.Util.isEmpty(t)?(this.handleLoadError(),o(s.error,t)):o(null,t)},n._cache.loadLWF(s)},this.setSettingsAndValidation(t,r),this._rendererSelector.renderer=this._playerSettings.renderer}return Object.defineProperty(t.prototype,"coordinator",{get:function(){return this._coordinator},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"playerSettings",{get:function(){return this._playerSettings},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"lwfSettings",{get:function(){return this._lwfSettings},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"rendererSelector",{get:function(){return this._rendererSelector},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"stageContractor",{get:function(){return this._stageContractor},enumerable:!0,configurable:!0}),t}();e.Player=t}(LwfPlayer||(LwfPlayer={}));