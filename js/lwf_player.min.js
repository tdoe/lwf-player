var LwfPlayer;!function(a){"use strict";!function(a){a[a.useCanvasRenderer=0]="useCanvasRenderer",a[a.useWebkitCSSRenderer=1]="useWebkitCSSRenderer",a[a.useWebGLRenderer=2]="useWebGLRenderer"}(a.RendererName||(a.RendererName={}));a.RendererName}(LwfPlayer||(LwfPlayer={}));var LwfPlayer;!function(a){"use strict";var b=function(){function b(){var b=this;this.autoSelectRenderer=function(){for(var c=document.createElement("canvas"),d=["webgl","experimental-webgl"],e=0;e<d.length;e++)if(c.getContext(d[e])){b._renderer=a.RendererName[2];break}/iP(ad|hone|od).*OS 4/.test(a.Util.ua)?b._renderer=a.RendererName[1]:/Android 2\.1/.test(a.Util.ua)||/Android 2\.3\.[5-7]/.test(a.Util.ua)?b._renderer=a.RendererName[1]:/Android 4/.test(a.Util.ua)&&(b._renderer=/Chrome/.test(a.Util.ua)?a.RendererName[0]:a.RendererName[1]),a.Util.isEmpty(b._renderer)&&(b._renderer=a.RendererName[0])},this.autoSelectRenderer()}return Object.defineProperty(b.prototype,"renderer",{get:function(){return this._renderer},set:function(b){if(a.Util.isEmpty(b))return void this.autoSelectRenderer();switch(b){case a.RendererName[0]:case a.RendererName[1]:case a.RendererName[2]:this._renderer=b;break;default:throw new Error("unsupported renderer:"+b)}this.autoSelectRenderer()},enumerable:!0,configurable:!0}),b}();a.RendererSelector=b}(LwfPlayer||(LwfPlayer={}));var LwfPlayer;!function(a){"use strict";var b=function(){function b(){}return b.ua=global.navigator.userAgent,b.isiOS=/iP(ad|hone|od)/.test(b.ua),b.isAndroid=/Android/.test(b.ua),b.isSp=b.isiOS||b.isAndroid,b.isChrome=/Chrome/.test(b.ua),b.isTouchEventEnabled=b.isSp,b.useWebWorker=!b.isAndroid||b.isChrome,b.isPreventDefaultEnabled=b.isiOS||/Android *(4|3)\..*/.test(b.ua),b.forceSettingForAndroid=function(c,d){c.use3D=!1,c.worker&&(c.worker=b.useWebWorker),/ (SC-0|Galaxy Nexus|SH-0)/.test(b.ua)&&d===a.RendererName[1]&&(c.quirkyClearRect=!0)},b.getOpacity=function(c){return c===a.RendererName[1]&&/Android 2\.3\.[5-7]/.test(b.ua)&&/SH/.test(b.ua)?"0.9999":null},b.getStageWidth=function(){return global.innerWidth>global.screen.width?global.screen.width:global.innerWidth},b.getStageHeight=function(){return global.innerHeight>global.screen.height?global.screen.height:global.innerHeight},b.isEmpty=function(a){if(void 0===a||null===a)return!0;if("string"==typeof a||a instanceof String||a instanceof Array)return 0===a.length;if(a instanceof Function||isFinite(a))return!1;for(var b in a)if(a.hasOwnProperty(b))return!1;return!(a instanceof Boolean)},b.isNotEmpty=function(a){return!b.isEmpty(a)},b}();if(a.Util=b,b.isEmpty(global.performance)&&(global.performance={}),global.performance.now=global.performance.now||global.performance.webkitNow||global.performance.mozNow||global.performance.oNow||global.performance.msNow||Date.now,global.requestAnimationFrame=global.requestAnimationFrame||global.webkitRequestAnimationFrame||global.mozRequestAnimationFrame||global.oRequestAnimationFrame||global.msRequestAnimationFrame,b.isEmpty(global.requestAnimationFrame)||/iP(ad|hone|od).*OS 6/.test(b.ua)){var c=1e3/60,d=global.performance.now();global.requestAnimationFrame=function(a){var b=global.performance.now(),e=b-d,f=c-(e>c?e%c:e);return setTimeout(function(){d=global.performance.now(),a()},f)}}b.isAndroid&&(b.isChrome||/ SC-0/.test(b.ua))&&document.body.addEventListener("touchstart",function(){})}(LwfPlayer||(LwfPlayer={}));var LwfPlayer;!function(a){"use strict";var b=function(){function b(b){var c=this;this._player=null,this._targetStage=null,this._screenStage=null,this._stageScale=1,this._devicePixelRatio=global._devicePixelRatio,this._debugInfo=null,this._from=global.performance.now(),this._currentFPS=0,this._execCount=0,this._stageWidth=0,this._stageHeight=0,this._stageStyleWidth=0,this._stageStyleHeight=0,this.changeStageSize=function(b,d){var e=a.Util.getStageWidth(),f=a.Util.getStageHeight();b>e&&(b=e),d>f&&(d=f),c._player.lwfSettings.fitForWidth?c.fitForWidth(b,d):c._player.lwfSettings.fitForHeight?c.fitForHeight(b,d):c.fitToScreen(b,d),c._screenStage.style.width=c._eventReceiveStage.style.width=c._stageStyleWidth+"px",c._screenStage.style.height=c._eventReceiveStage.style.height=c._stageStyleHeight+"px",c._screenStage.setAttribute("width",c._stageWidth+""),c._screenStage.setAttribute("height",c._stageHeight+"")},this.fitForWidth=function(a,b){c._stageStyleWidth=Math.round(a),c._stageStyleHeight=Math.round(a*b/a),c.setStageWidthAndHeight(),c._stageScale=c._stageStyleWidth/c._stageWidth},this.fitForHeight=function(a,b){c._stageStyleWidth=Math.round(b*a/b),c._stageStyleHeight=Math.round(b),c.setStageWidthAndHeight(),c._stageScale=c._stageStyleHeight/c._stageHeight},this.fitToScreen=function(b,d){var e=a.Util.getStageWidth(),f=a.Util.getStageHeight(),g=b/d,h=e/f;h>g?(c._stageStyleWidth=b*(f/d),c._stageStyleHeight=f,c.setStageWidthAndHeight(),c._stageScale=c._stageStyleWidth/c._stageWidth):(c._stageStyleWidth=e,c._stageStyleHeight=d*(e/b),c.setStageWidthAndHeight(),c._stageScale=c._stageStyleHeight/c._stageHeight)},this.setStageWidthAndHeight=function(){c._stageWidth=Math.floor(c._stageStyleWidth*c._devicePixelRatio),c._stageHeight=Math.floor(c._stageStyleHeight*c._devicePixelRatio)},this.addEventListeners=function(){a.Util.isTouchEventEnabled?(c._eventReceiveStage.addEventListener("touchmove",c._player.onMove,!1),c._eventReceiveStage.addEventListener("touchstart",c._player.onPress,!1),c._eventReceiveStage.addEventListener("touchend",c._player.onRelease,!1)):(c._eventReceiveStage.addEventListener("mousedown",c._player.onPress,!1),c._eventReceiveStage.addEventListener("mousemove",c._player.onMove,!1),c._eventReceiveStage.addEventListener("mouseup",c._player.onRelease,!1))},this.removeEventListeners=function(){a.Util.isTouchEventEnabled?(c._eventReceiveStage.removeEventListener("touchstart",c._player.onPress,!1),c._eventReceiveStage.removeEventListener("touchmove",c._player.onMove,!1),c._eventReceiveStage.removeEventListener("touchend",c._player.onRelease,!1)):(c._eventReceiveStage.removeEventListener("mousedown",c._player.onPress,!1),c._eventReceiveStage.removeEventListener("mousemove",c._player.onMove,!1),c._eventReceiveStage.removeEventListener("mouseup",c._player.onRelease,!1))},this.createScreenStage=function(b){c._screenStage=document.createElement(b.renderer===a.RendererName[0]||b.renderer===a.RendererName[2]?"canvas":"div");var d=c._player.lwfSettings.pos;a.Util.isEmpty(d)&&(c._player.lwfSettings.initPos(),d=c._player.lwfSettings.pos),c._screenStage.style.position=d.position,c._screenStage.style.top=d.top+"px",c._screenStage.style.left=d.left+"px",c._screenStage.style.zIndex=c._targetStage.style.zIndex+1,c._screenStage.style.opacity=a.Util.getOpacity(b.renderer),c._targetStage.appendChild(c._screenStage)},this.createEventReceiveStage=function(){var a=c._player.lwfSettings.pos;c._eventReceiveStage=document.createElement("div"),c._eventReceiveStage.style.position="absolute",c._eventReceiveStage.style.top=a.top+"px",c._eventReceiveStage.style.left=a.left+"px",c._eventReceiveStage.style.zIndex=c._screenStage.style.zIndex+1,c._targetStage.appendChild(c._eventReceiveStage)},this.viewDebugInfo=function(){if(a.Util.isEmpty(c._debugInfo)&&(c._debugInfo=document.createElement("div"),c._debugInfo.style.position="absolute",c._debugInfo.style.top="0px",c._debugInfo.style.left="0px",c._debugInfo.style.zIndex="9999",c._debugInfo.style.color="red",c._debugInfo.id="__lwfPlayerDebugInfoID",c._targetStage.appendChild(c._debugInfo)),c._execCount%60===0){var b=global.performance.now();c._currentFPS=Math.round(6e4/(b-c._from)),c._from=b,c._execCount=0}var d=c._player.coordinator.x,e=c._player.coordinator.y,f=c._player.rendererSelector.renderer.substring(3);f=f.substring(0,f.lastIndexOf("Renderer")),c._execCount++,c._debugInfo.innerHTML=f+" "+c._currentFPS+"fps X:"+d+" Y:"+e+"<br>sw:"+c._stageStyleWidth+" sh:"+c._stageStyleHeight+" w:"+c._stageWidth+" h:"+c._stageHeight+" s:"+c._stageScale+" dpr:"+c.devicePixelRatio},this._player=b,this._targetStage=this._player.playerSettings.targetStage,("static"===this._targetStage.style.position||a.Util.isEmpty(this._targetStage.style.position))&&(this._targetStage.style.position="relative"),this._player.rendererSelector.renderer===a.RendererName[1]&&(this._devicePixelRatio=1),this._player.rendererSelector.renderer===a.RendererName[2]&&/ F-/.test(a.Util.ua)&&(this._devicePixelRatio=2),a.Util.isEmpty(this._devicePixelRatio)&&(this._devicePixelRatio=1)}return Object.defineProperty(b.prototype,"devicePixelRatio",{get:function(){return this._devicePixelRatio},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"stageScale",{get:function(){return this._stageScale},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"screenStage",{get:function(){return this._screenStage},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"screenStageWidth",{get:function(){return+this._screenStage.getAttribute("width")},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"screenStageHeight",{get:function(){return+this._screenStage.getAttribute("height")},enumerable:!0,configurable:!0}),b}();a.StageContractor=b}(LwfPlayer||(LwfPlayer={}));var LwfPlayer;!function(a){var b=function(){function b(b){var c=this;this._x=0,this._y=0,this._isPreventDefaultEnabled=a.Util.isPreventDefaultEnabled,this.setCoordinate=function(b){c._isPreventDefaultEnabled&&b.preventDefault();var d=c._stageContractor.screenStage.getBoundingClientRect(),e=c._stageContractor.stageScale;a.Util.isTouchEventEnabled?(c._x=b.touches[0].pageX,c._y=b.touches[0].pageY):(c._x=b.clientX,c._y=b.clientY),c._x-=d.left,c._y-=d.top,a.Util.isSp&&(c._x-=global.scrollX,c._y-=global.scrollY),c._x/=e,c._y/=e},this._stageContractor=b}return Object.defineProperty(b.prototype,"preventDefaultEnabled",{set:function(a){this._isPreventDefaultEnabled=a},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"x",{get:function(){return this._x},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"y",{get:function(){return this._y},enumerable:!0,configurable:!0}),b}();a.Coordinator=b}(LwfPlayer||(LwfPlayer={}));var LwfPlayer;!function(a){"use strict";var b=function(){function b(){}return b.getLwfPath=function(a){var b=a;return a.indexOf("/")>=0&&(b=a.substring(a.lastIndexOf("/")+1)),a+"/_/"+b+".lwf"},b.setLoader=function(a,b){b.privateData.lwfLoader=a},b.prepareChildLwfSettings=function(b,c,d,e,f){var g=new a.LwfSettings;for(var h in f)f.hasOwnProperty(h)&&(g[h]=f[h]);return a.Util.isNotEmpty(d)?g.imageMap=a.LwfSettings.getImageMapper(d):e.hasOwnProperty("imageMap")&&(g.imageMap=a.LwfSettings.getImageMapper(e.imageMap)),a.Util.isNotEmpty(e)&&(g.privateData=e),g.fitForHeight=!1,g.fitForWidth=!1,g.parentLWF=b,g.active=!1,g.lwf=g.getLwfPath(c),g.stage=f.stage,g},b}();a.LwfLoader=b}(LwfPlayer||(LwfPlayer={}));var LwfPlayer;!function(a){"use strict";var b=function(){function b(){var c=this;this.validationLwfSettings=function(){if(a.Util.isEmpty(c.lwf))throw new Error("lwf property is require.")},this.initPos=function(){c.pos={position:"absolute",top:0,left:0}},this.prepareLwfSettings=function(d){a.Util.isEmpty(c.privateData)&&(c.privateData={}),a.Util.isEmpty(c.useBackgroundColor)&&(c.useBackgroundColor=!0),c.stage=d.stageContractor.screenStage,c.imageMap=b.getImageMapper(c.imageMap),a.Util.isAndroid&&a.Util.forceSettingForAndroid(c,d.rendererSelector.renderer),c.onload=d.onLoad,a.LwfLoader.setLoader(d,c)},this.getLwfPath=function(b){if(a.Util.isNotEmpty(c.lwfMap)){if(c.lwfMap instanceof Function)return c.lwfMap(b);var d=c.lwfMap[b];return/\.lwf$/.test(d)||(d+=".lwf"),d}return a.LwfLoader.getLwfPath(b)}}return b.getImageMapper=function(a){return a instanceof Function?a:function(b){return a&&a.hasOwnProperty(b)?a[b]:b}},b}();a.LwfSettings=b}(LwfPlayer||(LwfPlayer={}));var LwfPlayer;!function(a){var b=function(){function b(){var b=this;this.validationPlayerSettings=function(){if(a.Util.isEmpty(b.targetStage))throw new Error("targetStage property is need HTMLElement")}}return Object.defineProperty(b.prototype,"renderer",{get:function(){return this._renderer},set:function(a){this._renderer=a},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"isDebugMode",{get:function(){return this._isDebugMode},set:function(a){this._isDebugMode=a},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"targetStage",{get:function(){return this._targetStage},set:function(a){this._targetStage=a},enumerable:!0,configurable:!0}),b}();a.PlayerSettings=b}(LwfPlayer||(LwfPlayer={}));var LwfPlayer;!function(a){"use strict";var b=function(){function b(b,c){var d=this;this._lwf=null,this._cache=null,this._playerSettings=null,this._lwfSettings=new a.LwfSettings,this._stageContractor=null,this._coordinator=null,this._rendererSelector=new a.RendererSelector,this._inputQueue=[],this._fromTime=global.performance.now(),this._pausing=!1,this._goPlayBack=!1,this._destroyed=!1,this._goRestart=!1,this.play=function(){d.initStage(),d.initLwf(),d._lwfSettings.prepareLwfSettings(d),d._cache.loadLWF(d._lwfSettings)},this.pause=function(){d._pausing=!0},this.resume=function(){d._pausing=!1},this.playBack=function(){d._goPlayBack=!0},this.reStart=function(a){d._goRestart=!0,d.setSettingsAndValidation(d._playerSettings,a),d._lwfSettings.prepareLwfSettings(d),d._cache.loadLWF(d._lwfSettings)},this.destroy=function(){d._destroyed=!0},this.handleLoadError=function(){d._lwfSettings.handler&&d._lwfSettings.handler.loadError instanceof Function&&d._lwfSettings.handler.loadError(d._lwfSettings.error),console.error("[LWF] load error: %o",d._lwfSettings.error)},this.handleException=function(a){d._lwfSettings.handler&&d._lwfSettings.handler.exception instanceof Function&&d._lwfSettings.handler.exception(a),console.error("[LWF] load Exception: %o",a)},this.exec=function(){try{if(d._goRestart)return void(d._goRestart=!1);if(d._destroyed)return void d.destroyLwf();if(d._goPlayBack&&(d._goPlayBack=!1,d._lwf.init()),a.Util.isNotEmpty(d._lwf)&&!d._pausing){for(var b=0;b<d._inputQueue.length;b++)d._inputQueue[b].apply(d);d._stageContractor.changeStageSize(d._lwf.width,d._lwf.height),d.renderLwf()}d._inputQueue=[],global.requestAnimationFrame(function(){d.exec()})}catch(c){d.handleException(c)}},this.initStage=function(){d._stageContractor=new a.StageContractor(d),d._stageContractor.createScreenStage(d._rendererSelector),d._stageContractor.createEventReceiveStage(),d._stageContractor.addEventListeners(),d._coordinator=new a.Coordinator(d._stageContractor)},this.initLwf=function(){try{switch(d._rendererSelector.renderer){case a.RendererName[0]:global.LWF.useCanvasRenderer();break;case a.RendererName[1]:global.LWF.useWebkitCSSRenderer();break;case a.RendererName[2]:global.LWF.useWebGLRenderer();break;default:throw new Error("not supported renderer")}d._cache=global.LWF.ResourceCache.get()}catch(b){d.handleException(b)}},this.renderLwf=function(){var b=d._stageContractor.screenStageWidth,c=d._stageContractor.screenStageHeight,e=global.performance.now(),f=(e-d._fromTime)/1e3;d._fromTime=e,d._lwf.property.clear(),d._lwfSettings.fitForWidth?d._lwf.fitForWidth(b,c):d._lwf.fitForHeight(b,c),d.rendererSelector.renderer===a.RendererName[1]&&d._lwf.setTextScale(d.stageContractor.devicePixelRatio),d._lwf.property.moveTo(0,0),d._lwf.exec(f),d._lwf.render(),d._playerSettings.isDebugMode&&d._stageContractor.viewDebugInfo()},this.destroyLwf=function(){a.Util.isNotEmpty(d._lwf)&&(d._stageContractor.removeEventListeners(),d._lwf.destroy(),d._cache=null,d._lwf=null,console.log("destroy LWF.")),console.log("LWF is destroyed.")},this.setSettingsAndValidation=function(b,c){if(a.Util.isEmpty(b)||a.Util.isEmpty(c))throw new Error("not enough argument.");if(!(b instanceof a.PlayerSettings&&c instanceof a.LwfSettings))throw new TypeError("require PlayerSettings instance and LwfSettings instance. ex sample/sample1/index.html");d._playerSettings=b,d._playerSettings.validationPlayerSettings(),d._lwfSettings=c,d._lwfSettings.validationLwfSettings()},this.inputPoint=function(a){d._coordinator.setCoordinate(a),d._lwf.inputPoint(d._coordinator.x,d._coordinator.y)},this.inputPress=function(a){d.inputPoint(a),d._lwf.inputPress()},this.onMove=function(a){d._inputQueue.push(function(){this.inputPoint(a)})},this.onPress=function(a){d._inputQueue.push(function(){this.inputPress(a)})},this.onRelease=function(){d._inputQueue.push(function(){this._lwf.inputRelease()})},this.onLoad=function(b){a.Util.isNotEmpty(b)?(d._lwf=b,d.exec()):d.handleLoadError()},this.loadLWF=function(b,c,e,f,g){var h=a.LwfLoader.prepareChildLwfSettings(b,c,e,f,d._lwfSettings);h.onload=function(b){return a.Util.isEmpty(b)?(this.handleLoadError(),g(h.error,b)):g(null,b)},d._cache.loadLWF(h)},this.setSettingsAndValidation(b,c),this._rendererSelector.renderer=this._playerSettings.renderer}return Object.defineProperty(b.prototype,"coordinator",{get:function(){return this._coordinator},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"playerSettings",{get:function(){return this._playerSettings},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"lwfSettings",{get:function(){return this._lwfSettings},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"rendererSelector",{get:function(){return this._rendererSelector},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"stageContractor",{get:function(){return this._stageContractor},enumerable:!0,configurable:!0}),b}();a.Player=b}(LwfPlayer||(LwfPlayer={}));