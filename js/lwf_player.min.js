var LwfPlayer;!function(a){"use strict";var b=function(){function b(){this.autoSelectRenderer()}return b.prototype.getRenderer=function(){return this.renderer},b.prototype.setRenderer=function(c){if(a.Util.isEmpty(c.renderer))return void this.autoSelectRenderer();switch(c.renderer){case b.canvasRenderer:case b.webkitCSSRenderer:case b.webGLRenderer:this.renderer=c.renderer;break;default:throw new Error("unsupported renderer:"+c.renderer)}this.autoSelectRenderer()},b.prototype.autoSelectRenderer=function(){for(var c=document.createElement("canvas"),d=["webgl","experimental-webgl"],e=0;e<d.length;e++)if(c.getContext(d[e])){this.renderer=b.webGLRenderer;break}/iP(ad|hone|od).*OS 4/.test(a.Util.ua)?this.renderer=b.webkitCSSRenderer:/Android 2\.1/.test(a.Util.ua)||/Android 2\.3\.[5-7]/.test(a.Util.ua)?this.renderer=b.webkitCSSRenderer:/Android 4/.test(a.Util.ua)&&(this.renderer=/Chrome/.test(a.Util.ua)?b.canvasRenderer:b.webkitCSSRenderer),a.Util.isEmpty(this.renderer)&&(this.renderer=b.canvasRenderer)},b.webkitCSSRenderer="useWebkitCSSRenderer",b.webGLRenderer="useWebGLRenderer",b.canvasRenderer="useCanvasRenderer",b}();a.RendererSelector=b}(LwfPlayer||(LwfPlayer={}));var LwfPlayer;!function(a){"use strict";var b=function(){function b(){}return b.forceSettingForAndroid=function(c,d){c.use3D=!1,c.worker&&(c.worker=b.useWebWorker),/ (SC-0|Galaxy Nexus|SH-0)/.test(b.ua)&&d===a.RendererSelector.webkitCSSRenderer&&(c.quirkyClearRect=!0)},b.getOpacity=function(c){return c===a.RendererSelector.webkitCSSRenderer&&/Android 2\.3\.[5-7]/.test(b.ua)&&/SH/.test(b.ua)?"0.9999":null},b.getStageWidth=function(){return global.innerWidth>global.screen.width?global.screen.width:global.innerWidth},b.getStageHeight=function(){return global.innerHeight>global.screen.height?global.screen.height:global.innerHeight},b.isEmpty=function(a){if(void 0===a||null===a)return!0;if("string"==typeof a||a instanceof String||a instanceof Array)return 0===a.length;if(a instanceof Function||isFinite(a))return!1;for(var b in a)if(a.hasOwnProperty(b))return!1;return!(a instanceof Boolean)},b.isNotEmpty=function(a){return!b.isEmpty(a)},b.ua=global.navigator.userAgent,b.isiOS=/iP(ad|hone|od)/.test(b.ua),b.isAndroid=/Android/.test(b.ua),b.isSp=b.isiOS||b.isAndroid,b.isChrome=/Chrome/.test(b.ua),b.isTouchEventEnabled=b.isSp,b.useWebWorker=!b.isAndroid||b.isChrome,b.isPreventDefaultEnabled=b.isiOS||/Android *(4|3)\..*/.test(b.ua),b}();if(a.Util=b,b.isEmpty(global.performance)&&(global.performance={}),global.performance.now=global.performance.now||global.performance.webkitNow||global.performance.mozNow||global.performance.oNow||global.performance.msNow||Date.now,global.requestAnimationFrame=global.requestAnimationFrame||global.webkitRequestAnimationFrame||global.mozRequestAnimationFrame||global.oRequestAnimationFrame||global.msRequestAnimationFrame,b.isEmpty(global.requestAnimationFrame)||/iP(ad|hone|od).*OS 6/.test(b.ua)){var c=1e3/60,d=global.performance.now();global.requestAnimationFrame=function(a){var b=global.performance.now(),e=b-d,f=c-(e>c?e%c:e);return setTimeout(function(){d=global.performance.now(),a()},f)}}b.isAndroid&&(b.isChrome||/ SC-0/.test(b.ua))&&document.body.addEventListener("touchstart",function(){})}(LwfPlayer||(LwfPlayer={}));var LwfPlayer;!function(a){"use strict";var b=function(){function b(b){this.player=null,this.targetStage=null,this.screenStage=null,this.stageScale=1,this.devicePixelRatio=global.devicePixelRatio,this.debugInfo=null,this.from=global.performance.now(),this.currentFPS=0,this.execCount=0,this.stageWidth=0,this.stageHeight=0,this.stageStyleWidth=0,this.stageStyleHeight=0,this.player=b,this.targetStage=this.player.getPlayerSettings().targetStage,("static"===this.targetStage.style.position||a.Util.isEmpty(this.targetStage.style.position))&&(this.targetStage.style.position="relative"),this.player.getRendererSelector().getRenderer()===a.RendererSelector.webkitCSSRenderer&&(this.devicePixelRatio=1),this.player.getRendererSelector().getRenderer()===a.RendererSelector.webGLRenderer&&/ F-/.test(a.Util.ua)&&(this.devicePixelRatio=2),a.Util.isEmpty(this.devicePixelRatio)&&(this.devicePixelRatio=1)}return b.prototype.getDevicePixelRatio=function(){return this.devicePixelRatio},b.prototype.getStageScale=function(){return this.stageScale},b.prototype.getScreenStage=function(){return this.screenStage},b.prototype.getScreenStageWidth=function(){return+this.screenStage.getAttribute("width")},b.prototype.getScreenStageHeight=function(){return+this.screenStage.getAttribute("height")},b.prototype.changeStageSize=function(b,c){var d=a.Util.getStageWidth(),e=a.Util.getStageHeight();b>d&&(b=d),c>e&&(c=e),this.player.getLwfSettings().fitForWidth?this.fitForWidth(b,c):this.player.getLwfSettings().fitForHeight?this.fitForHeight(b,c):this.fitToScreen(b,c),this.screenStage.style.width=this.eventReceiveStage.style.width=this.stageStyleWidth+"px",this.screenStage.style.height=this.eventReceiveStage.style.height=this.stageStyleHeight+"px",this.screenStage.setAttribute("width",this.stageWidth+""),this.screenStage.setAttribute("height",this.stageHeight+"")},b.prototype.fitForWidth=function(a,b){this.stageStyleWidth=Math.round(a),this.stageStyleHeight=Math.round(a*b/a),this.setStageWidthAndHeight(),this.stageScale=this.stageStyleWidth/this.stageWidth},b.prototype.fitForHeight=function(a,b){this.stageStyleWidth=Math.round(b*a/b),this.stageStyleHeight=Math.round(b),this.setStageWidthAndHeight(),this.stageScale=this.stageStyleHeight/this.stageHeight},b.prototype.fitToScreen=function(b,c){var d=a.Util.getStageWidth(),e=a.Util.getStageHeight(),f=b/c,g=d/e;g>f?(this.stageStyleWidth=b*(e/c),this.stageStyleHeight=e,this.setStageWidthAndHeight(),this.stageScale=this.stageStyleWidth/this.stageWidth):(this.stageStyleWidth=d,this.stageStyleHeight=c*(d/b),this.setStageWidthAndHeight(),this.stageScale=this.stageStyleHeight/this.stageHeight)},b.prototype.setStageWidthAndHeight=function(){this.stageWidth=Math.floor(this.stageStyleWidth*this.devicePixelRatio),this.stageHeight=Math.floor(this.stageStyleHeight*this.devicePixelRatio)},b.prototype.addEventListeners=function(){a.Util.isTouchEventEnabled?(this.eventReceiveStage.addEventListener("touchmove",this.player.onMove,!1),this.eventReceiveStage.addEventListener("touchstart",this.player.onPress,!1),this.eventReceiveStage.addEventListener("touchend",this.player.onRelease,!1)):(this.eventReceiveStage.addEventListener("mousedown",this.player.onPress,!1),this.eventReceiveStage.addEventListener("mousemove",this.player.onMove,!1),this.eventReceiveStage.addEventListener("mouseup",this.player.onRelease,!1))},b.prototype.removeEventListeners=function(){a.Util.isTouchEventEnabled?(this.eventReceiveStage.removeEventListener("touchstart",this.player.onPress,!1),this.eventReceiveStage.removeEventListener("touchmove",this.player.onMove,!1),this.eventReceiveStage.removeEventListener("touchend",this.player.onRelease,!1)):(this.eventReceiveStage.removeEventListener("mousedown",this.player.onPress,!1),this.eventReceiveStage.removeEventListener("mousemove",this.player.onMove,!1),this.eventReceiveStage.removeEventListener("mouseup",this.player.onRelease,!1))},b.prototype.createScreenStage=function(b){this.screenStage=document.createElement(b.getRenderer()===a.RendererSelector.canvasRenderer||b.getRenderer()===a.RendererSelector.webGLRenderer?"canvas":"div");var c=this.player.getLwfSettings().pos;a.Util.isEmpty(c)&&(this.player.getLwfSettings().initPos(),c=this.player.getLwfSettings().pos),this.screenStage.style.position=c.position,this.screenStage.style.top=c.top+"px",this.screenStage.style.left=c.left+"px",this.screenStage.style.zIndex=this.targetStage.style.zIndex+1,this.screenStage.style.opacity=a.Util.getOpacity(b.getRenderer()),this.targetStage.appendChild(this.screenStage)},b.prototype.createEventReceiveStage=function(){var a=this.player.getLwfSettings().pos;this.eventReceiveStage=document.createElement("div"),this.eventReceiveStage.style.position="absolute",this.eventReceiveStage.style.top=a.top+"px",this.eventReceiveStage.style.left=a.left+"px",this.eventReceiveStage.style.zIndex=this.screenStage.style.zIndex+1,this.targetStage.appendChild(this.eventReceiveStage)},b.prototype.viewDebugInfo=function(){if(a.Util.isEmpty(this.debugInfo)&&(this.debugInfo=document.createElement("div"),this.debugInfo.style.position="absolute",this.debugInfo.style.top="0px",this.debugInfo.style.left="0px",this.debugInfo.style.zIndex="9999",this.debugInfo.style.color="red",this.debugInfo.id="__lwfPlayerDebugInfoID",this.targetStage.appendChild(this.debugInfo)),this.execCount%60===0){var b=global.performance.now();this.currentFPS=Math.round(6e4/(b-this.from)),this.from=b,this.execCount=0}var c=this.player.getCoordinator().getX(),d=this.player.getCoordinator().getY(),e=this.player.getRendererSelector().getRenderer().substring(3);e=e.substring(0,e.lastIndexOf("Renderer")),this.execCount++,this.debugInfo.innerHTML=e+" "+this.currentFPS+"fps X:"+c+" Y:"+d+"<br>sw:"+this.stageStyleWidth+" sh:"+this.stageStyleHeight+" w:"+this.stageWidth+" h:"+this.stageHeight+" s:"+this.stageScale+" dpr:"+this.getDevicePixelRatio()},b}();a.StageContractor=b}(LwfPlayer||(LwfPlayer={}));var LwfPlayer;!function(a){var b=function(){function b(b){this.x=0,this.y=0,this.isPreventDefaultEnabled=a.Util.isPreventDefaultEnabled,this.stageContractor=b}return b.prototype.setIsPreventDefaultEnabled=function(a){this.isPreventDefaultEnabled=a},b.prototype.setCoordinate=function(b){this.isPreventDefaultEnabled&&b.preventDefault();var c=this.stageContractor.getScreenStage().getBoundingClientRect(),d=this.stageContractor.getStageScale();a.Util.isTouchEventEnabled?(this.x=b.touches[0].pageX,this.y=b.touches[0].pageY):(this.x=b.clientX,this.y=b.clientY),this.x-=c.left,this.y-=c.top,a.Util.isSp&&(this.x-=global.scrollX,this.y-=global.scrollY),this.x/=d,this.y/=d},b.prototype.getX=function(){return this.x},b.prototype.getY=function(){return this.y},b}();a.Coordinator=b}(LwfPlayer||(LwfPlayer={}));var LwfPlayer;!function(a){"use strict";var b=function(){function b(){}return b.getLwfPath=function(a){var b=a;return a.indexOf("/")>=0&&(b=a.substring(a.lastIndexOf("/")+1)),a+"/_/"+b+".lwf"},b.setLoader=function(a,b){b.privateData.lwfLoader=a},b.prepareChildLwfSettings=function(b,c,d,e,f){var g=new a.LwfSettings;for(var h in f)f.hasOwnProperty(h)&&(g[h]=f[h]);return a.Util.isNotEmpty(d)?g.imageMap=a.LwfSettings.getImageMapper(d):e.hasOwnProperty("imageMap")&&(g.imageMap=a.LwfSettings.getImageMapper(e.imageMap)),a.Util.isNotEmpty(e)&&(g.privateData=e),g.fitForHeight=!1,g.fitForWidth=!1,g.parentLWF=b,g.active=!1,g.lwf=g.getLwfPath(c),g.stage=f.stage,g},b}();a.LwfLoader=b}(LwfPlayer||(LwfPlayer={}));var LwfPlayer;!function(a){"use strict";var b=function(){function b(){}return b.prototype.validationLwfSettings=function(){if(a.Util.isEmpty(this.lwf))throw new Error("lwf property is require.")},b.prototype.initPos=function(){this.pos={position:"absolute",top:0,left:0}},b.prototype.prepareLwfSettings=function(c){a.Util.isEmpty(this.privateData)&&(this.privateData={}),a.Util.isEmpty(this.useBackgroundColor)&&(this.useBackgroundColor=!0),this.stage=c.getStageContractor().getScreenStage(),this.imageMap=b.getImageMapper(this.imageMap),a.Util.isAndroid&&a.Util.forceSettingForAndroid(this,c.getRendererSelector().getRenderer()),this.onload=c.onLoad,a.LwfLoader.setLoader(c,this)},b.getImageMapper=function(a){return a instanceof Function?a:function(b){return a&&a.hasOwnProperty(b)?a[b]:b}},b.prototype.getLwfPath=function(b){if(a.Util.isNotEmpty(this.lwfMap)){if(this.lwfMap instanceof Function)return this.lwfMap(b);var c=this.lwfMap[b];return/\.lwf$/.test(c)||(c+=".lwf"),c}return a.LwfLoader.getLwfPath(b)},b}();a.LwfSettings=b}(LwfPlayer||(LwfPlayer={}));var LwfPlayer;!function(a){var b=function(){function b(){}return b.prototype.validationPlayerSettings=function(){if(a.Util.isEmpty(this.targetStage))throw new Error("targetStage property is need HTMLElement")},b}();a.PlayerSettings=b}(LwfPlayer||(LwfPlayer={}));var LwfPlayer;!function(a){"use strict";var b=function(){function b(b,c){this.lwf=null,this.cache=null,this.playerSettings=null,this.lwfSettings=new a.LwfSettings,this.stageContractor=null,this.coordinator=null,this.rendererSelector=new a.RendererSelector,this.inputQueue=[],this.fromTime=global.performance.now(),this.pausing=!1,this.goPlayBack=!1,this.destroyed=!1,this.goRestart=!1,this.setSettingsAndValidation(b,c),this.rendererSelector.setRenderer(this.playerSettings)}return b.prototype.play=function(){this.restraint(),this.initStage(),this.initLwf(),this.lwfSettings.prepareLwfSettings(this),this.cache.loadLWF(this.lwfSettings)},b.prototype.pause=function(){this.pausing=!0},b.prototype.resume=function(){this.pausing=!1},b.prototype.playBack=function(){this.goPlayBack=!0},b.prototype.reStart=function(a){this.setSettingsAndValidation(this.playerSettings,a),this.lwfSettings.prepareLwfSettings(this),this.goRestart=!0,this.cache.loadLWF(this.lwfSettings)},b.prototype.destroy=function(){this.destroyed=!0},b.prototype.getCoordinator=function(){return this.coordinator},b.prototype.getPlayerSettings=function(){return this.playerSettings},b.prototype.getLwfSettings=function(){return this.lwfSettings},b.prototype.getRendererSelector=function(){return this.rendererSelector},b.prototype.getStageContractor=function(){return this.stageContractor},b.prototype.handleLoadError=function(){this.lwfSettings.handler&&this.lwfSettings.handler.loadError instanceof Function&&this.lwfSettings.handler.loadError(this.lwfSettings.error),console.error("[LWF] load error: %o",this.lwfSettings.error)},b.prototype.handleException=function(a){this.lwfSettings.handler&&this.lwfSettings.handler.exception instanceof Function&&this.lwfSettings.handler.exception(a),console.error("[LWF] load Exception: %o",a)},b.prototype.exec=function(){var b=this;try{if(this.goRestart)return void(this.goRestart=!1);if(this.destroyed)return void this.destroyLwf();if(this.goPlayBack&&(this.goPlayBack=!1,this.lwf.init()),a.Util.isNotEmpty(this.lwf)&&!this.pausing){for(var c=0;c<this.inputQueue.length;c++)this.inputQueue[c].apply(this);this.stageContractor.changeStageSize(this.lwf.width,this.lwf.height),this.renderLwf()}this.inputQueue=[],global.requestAnimationFrame(function(){b.exec()})}catch(d){b.handleException(d)}},b.prototype.initStage=function(){this.stageContractor=new a.StageContractor(this),this.stageContractor.createScreenStage(this.rendererSelector),this.stageContractor.createEventReceiveStage(),this.stageContractor.addEventListeners(),this.coordinator=new a.Coordinator(this.stageContractor)},b.prototype.initLwf=function(){try{switch(this.rendererSelector.getRenderer()){case a.RendererSelector.canvasRenderer:global.LWF.useCanvasRenderer();break;case a.RendererSelector.webkitCSSRenderer:global.LWF.useWebkitCSSRenderer();break;case a.RendererSelector.webGLRenderer:global.LWF.useWebGLRenderer();break;default:throw new Error("not supported renderer")}this.cache=global.LWF.ResourceCache.get()}catch(b){this.handleException(b)}},b.prototype.renderLwf=function(){var b=this.stageContractor.getScreenStageWidth(),c=this.stageContractor.getScreenStageHeight(),d=global.performance.now(),e=(d-this.fromTime)/1e3;this.fromTime=d,this.lwf.property.clear(),this.lwfSettings.fitForWidth?this.lwf.fitForWidth(b,c):this.lwf.fitForHeight(b,c),this.getRendererSelector().getRenderer()===a.RendererSelector.webkitCSSRenderer&&this.lwf.setTextScale(this.getStageContractor().getDevicePixelRatio()),this.lwf.property.moveTo(0,0),this.lwf.exec(e),this.lwf.render(),this.playerSettings.debug&&this.stageContractor.viewDebugInfo()},b.prototype.destroyLwf=function(){a.Util.isNotEmpty(this.lwf)&&(this.stageContractor.removeEventListeners(),this.lwf.destroy(),this.cache=null,this.lwf=null,console.log("destroy LWF.")),console.log("LWF is destroyed.")},b.prototype.setSettingsAndValidation=function(b,c){if(a.Util.isEmpty(b)||a.Util.isEmpty(c))throw new Error("not enough argument.");if(!(b instanceof a.PlayerSettings&&c instanceof a.LwfSettings))throw new TypeError("require PlayerSettings instance and LwfSettings instance. ex sample/sample1/index.html");this.playerSettings=b,this.playerSettings.validationPlayerSettings(),this.lwfSettings=c,this.lwfSettings.validationLwfSettings()},b.prototype.inputPoint=function(a){this.coordinator.setCoordinate(a),this.lwf.inputPoint(this.coordinator.getX(),this.coordinator.getY())},b.prototype.inputPress=function(a){this.inputPoint(a),this.lwf.inputPress()},b.prototype.onMove=function(a){this.inputQueue.push(function(){this.inputPoint(a)})},b.prototype.onPress=function(a){this.inputQueue.push(function(){this.inputPress(a)})},b.prototype.onRelease=function(){this.inputQueue.push(function(){this.lwf.inputRelease()})},b.prototype.onLoad=function(b){a.Util.isNotEmpty(b)?(this.lwf=b,this.exec()):this.handleLoadError()},b.prototype.restraint=function(){var a=function(a,b){return function(){a.apply(b,arguments)}};this.onRelease=a(this.onRelease,this),this.onPress=a(this.onPress,this),this.onMove=a(this.onMove,this),this.onLoad=a(this.onLoad,this)},b.prototype.loadLWF=function(b,c,d,e,f){var g=a.LwfLoader.prepareChildLwfSettings(b,c,d,e,this.lwfSettings),h=this;g.onload=function(b){return a.Util.isEmpty(b)?(h.handleLoadError(),f(g.error,b)):f(null,b)},this.cache.loadLWF(g)},b}();a.Player=b}(LwfPlayer||(LwfPlayer={}));