var LwfPlayer;!function(a){"use strict";var b=function(){function a(){}return a.initUtil=function(){if("undefined"==typeof global.performance&&(global.performance={}),global.performance.now=global.performance.now||global.performance.webkitNow||global.performance.mozNow||global.performance.oNow||global.performance.msNow||Date.now,global.requestAnimationFrame=global.requestAnimationFrame||global.webkitRequestAnimationFrame||global.mozRequestAnimationFrame||global.oRequestAnimationFrame||global.msRequestAnimationFrame,void 0===global.requestAnimationFrame||/iP(ad|hone|od).*OS 6/.test(a.ua)){var b=1e3/60,c=global.performance.now();global.requestAnimationFrame=function(a){var d=global.performance.now(),e=d-c,f=b-(e>b?e%b:e);return setTimeout(function(){c=global.performance.now(),a()},f)}}},a.ua=navigator.userAgent,a.isiOS=/iP(ad|hone|od)/.test(a.ua),a.isAndroid=/Android/.test(a.ua),a.isSp=a.isiOS||a.isAndroid,a.isChrome=/Chrome/.test(a.ua),a.isTouchEventEnabled=a.isSp,a.useWebWorker=!a.isAndroid||a.isChrome,a.debugInfoElementId=0,a}();a.Util=b}(LwfPlayer||(LwfPlayer={}));var LwfPlayer;!function(a){"use strict";var b=function(){function b(){this.autoSelectRenderer()}return b.prototype.getRenderer=function(){return this.renderer},b.prototype.setRenderer=function(a){this.renderer=b.canvasRenderer,a===b.rendererWebkitCSS?this.renderer=b.webkitCSSRenderer:a===b.rendererWebGL&&(this.renderer=b.webGLRenderer)},b.prototype.autoSelectRenderer=function(){for(var c=document.createElement("canvas"),d=["webgl","experimental-webgl","moz-webgl","webkit-3d"],e=0;e<d.length;e++)if(c.getContext(d[e]))return void(this.renderer=b.webGLRenderer);return/iP(ad|hone|od).*OS 4/.test(a.Util.ua)?void(this.renderer=b.webkitCSSRenderer):/Android 2\.1/.test(a.Util.ua)||/Android 2\.3\.[5-7]/.test(a.Util.ua)?void(this.renderer=b.webkitCSSRenderer):/Android 4/.test(a.Util.ua)?/Chrome/.test(a.Util.ua)?void(this.renderer=b.canvasRenderer):void(this.renderer=b.webkitCSSRenderer):void(this.renderer=b.canvasRenderer)},b.webkitCSSRenderer="useWebkitCSSRenderer",b.webGLRenderer="useWebGLRenderer",b.canvasRenderer="useCanvasRenderer",b.rendererWebkitCSS="webkitcss",b.rendererWebGL="webgl",b.rendererCanvas="canvas",b}();a.RendererSelector=b}(LwfPlayer||(LwfPlayer={}));var LwfPlayer;!function(a){var b=function(){function b(b){if(this.player=null,this.targetStage=null,this.screenStage=null,this.stageScale=1,this.devicePixelRatio=global.devicePixelRatio,this.debugInfo=null,this.from=global.performance.now(),this.currentFPS=0,this.execCount=0,this.player=b,this.targetStage=this.player.getPlayerSettings().targetStage,void 0===this.targetStage||null===this.targetStage)throw new Error;("static"===this.targetStage.style.position||""===this.targetStage.style.position)&&(this.targetStage.style.position="relative"),this.player.getRendererSelector().getRenderer()===a.RendererSelector.webkitCSSRenderer&&(this.devicePixelRatio=1),this.player.getRendererSelector().getRenderer()===a.RendererSelector.webGLRenderer&&/ F-/.test(a.Util.ua)&&(this.devicePixelRatio=2)}return b.prototype.getDevicePixelRatio=function(){return this.devicePixelRatio},b.prototype.getStageScale=function(){return this.stageScale},b.prototype.getScreenStage=function(){return this.screenStage},b.prototype.getScreenStageWidth=function(){return+this.screenStage.getAttribute("width")},b.prototype.getScreenStageHeight=function(){return+this.screenStage.getAttribute("height")},b.prototype.changeStageSize=function(b,c){var d=0,e=0,f=global.innerWidth,g=global.innerHeight,h=b/c,i=f/g;a.Util.isAndroid&&(global.innerWidth>global.screen.width&&(d=global.screen.width),global.innerHeight>global.screen.height&&(e=global.screen.height)),b>global.innerWidth&&(b=global.innerWidth),c>global.innerHeight&&(c=global.innerHeight),this.player.getLwfSettings().fitForWidth?(d=Math.round(b),e=Math.round(b*c/b),this.stageScale=d/d):this.player.getLwfSettings().fitForHeight?(d=Math.round(c*b/c),e=Math.round(c),this.stageScale=e/e):i>h?(d=b*(g/c),e=g):(d=f,e=c*(f/b)),this.screenStage.style.width=this.eventReceiveStage.style.width=d+"px",this.screenStage.style.height=this.eventReceiveStage.style.height=e+"px",this.screenStage.setAttribute("width",Math.floor(d*this.devicePixelRatio)+""),this.screenStage.setAttribute("height",Math.floor(e*this.devicePixelRatio)+""),this.eventReceiveStage.setAttribute("width",Math.floor(d*this.devicePixelRatio)+""),this.eventReceiveStage.setAttribute("height",Math.floor(e*this.devicePixelRatio)+"")},b.prototype.removeEventListeners=function(){a.Util.isTouchEventEnabled?(this.eventReceiveStage.removeEventListener("touchstart",this.player.onPress,!1),this.eventReceiveStage.removeEventListener("touchmove",this.player.onMove,!1),this.eventReceiveStage.removeEventListener("touchend",this.player.onRelease,!1)):(this.eventReceiveStage.removeEventListener("mousedown",this.player.onPress,!1),this.eventReceiveStage.removeEventListener("mousemove",this.player.onMove,!1),this.eventReceiveStage.removeEventListener("mouseup",this.player.onRelease,!1))},b.prototype.addEventListeners=function(){a.Util.isTouchEventEnabled?(a.Util.isAndroid&&(a.Util.isChrome||/ SC-0/.test(a.Util.ua))&&document.body.addEventListener("touchstart",function(){}),this.eventReceiveStage.addEventListener("touchstart",this.player.onPress,!1),this.eventReceiveStage.addEventListener("touchmove",this.player.onMove,!1),this.eventReceiveStage.addEventListener("touchend",this.player.onRelease,!1)):(this.eventReceiveStage.addEventListener("mousedown",this.player.onPress,!1),this.eventReceiveStage.addEventListener("mousemove",this.player.onMove,!1),this.eventReceiveStage.addEventListener("mouseup",this.player.onRelease,!1))},b.prototype.createScreenStage=function(b){this.screenStage=document.createElement(b.getRenderer()===a.RendererSelector.canvasRenderer||b.getRenderer()===a.RendererSelector.webGLRenderer?"canvas":"div");var c=this.player.getLwfSettings().pos;this.screenStage.style.position=c.position,this.screenStage.style.top=c.top+"px",this.screenStage.style.left=c.left+"px",this.screenStage.style.zIndex=this.targetStage.style.zIndex+1,b.getRenderer()===a.RendererSelector.webkitCSSRenderer&&/Android 2\.3\.[5-7]/.test(a.Util.ua)&&/SH/.test(a.Util.ua)&&(this.screenStage.style.opacity="0.9999"),this.targetStage.appendChild(this.screenStage),a.Util.isSp?(this.eventReceiveStage=document.createElement("div"),this.eventReceiveStage.style.position="absolute",this.eventReceiveStage.style.top=c.top+"px",this.eventReceiveStage.style.left=c.left+"px",this.eventReceiveStage.style.zIndex=this.screenStage.style.zIndex+1,this.targetStage.appendChild(this.eventReceiveStage)):this.eventReceiveStage=this.targetStage},b.prototype.viewDebugInfo=function(){if(null===this.debugInfo&&(this.debugInfo=document.createElement("div"),this.debugInfo.style.position="absolute",this.debugInfo.style.top="0px",this.debugInfo.style.left="0px",this.debugInfo.style.zIndex="9999",this.debugInfo.style.color="red",this.debugInfo.className="lwfPlayerDebugInfo",this.targetStage.appendChild(this.debugInfo)),this.execCount%60===0){var a=global.performance.now();this.currentFPS=Math.round(6e4/(a-this.from)),this.from=a,this.execCount=0}var b=this.player.getCoordinator().getX(),c=this.player.getCoordinator().getY();this.execCount++,this.debugInfo.innerHTML=this.player.getRendererSelector().getRenderer()+" "+this.currentFPS+"fps X:"+b+" Y:"+c},b}();a.StageContractor=b}(LwfPlayer||(LwfPlayer={}));var LwfPlayer;!function(a){var b=function(){function b(b){this.x=0,this.y=0,this.isPreventDefaultEnabled=a.Util.isiOS||/Android *(4|3)\..*/.test(a.Util.ua),this.stageContractor=b}return b.prototype.setIsPreventDefaultEnabled=function(a){this.isPreventDefaultEnabled=a},b.prototype.getInputPoint=function(b){this.isPreventDefaultEnabled&&b.preventDefault();var c=this.stageContractor.getScreenStage().getBoundingClientRect(),d=this.stageContractor.getStageScale();return a.Util.isTouchEventEnabled?(this.x=b.touches[0].pageX,this.y=b.touches[0].pageY):(this.x=b.clientX,this.y=b.clientY),this.x-=c.left,this.y-=c.top,a.Util.isSp&&(this.x-=global.scrollX,this.y-=global.scrollY),this.x/=d,this.y/=d,this},b.prototype.getX=function(){return this.x},b.prototype.getY=function(){return this.y},b}();a.Coordinator=b}(LwfPlayer||(LwfPlayer={}));var LwfPlayer;!function(a){"use strict";var b=function(){function b(){}return b.prototype.prepareLwfSettings=function(b,c){for(var d in c)c.hasOwnProperty(d)&&(this[d]=c[d]);void 0===this.privateData&&(this.privateData={}),void 0===this.useBackgroundColor&&(this.useBackgroundColor=!0),void 0===this.pos&&(this.pos={position:"absolute",top:0,left:0}),this.imageMap=this.getImageMapper(this.imageMap),a.Util.isAndroid&&(this.use3D=!1,this.worker&&(this.worker=a.Util.useWebWorker),/ (SC-0|Galaxy Nexus|SH-0)/.test(a.Util.ua)&&b.getRendererSelector().getRenderer()===a.RendererSelector.webkitCSSRenderer&&(this.quirkyClearRect=!0)),this.privateData.lwfLoader=b},b.prototype.prepareChildLwfSettings=function(a,c,d,e){var f=new b;f.privateData={};for(var g in e)e.hasOwnProperty(g)&&(f.privateData[g]=e[g]);return void 0!==d||null!==d?f.imageMap=d:e.hasOwnProperty("imageMap")&&(f.imageMap=this.getImageMapper(e.imageMap)),f.fitForHeight=!1,f.fitForWidth=!1,f.parentLWF=a,f.active=!1,f.lwf=this.getLwfPath(c),f.stage=this.stage,f},b.prototype.getImageMapper=function(a){return"function"==typeof a?a:function(b){return a&&a.hasOwnProperty(b)?a[b]:b}},b.prototype.getLwfPath=function(a){if(void 0!==this.lwfMap){if("function"==typeof this.lwfMap)return this.lwfMap(a);var b=this.lwfMap[a];return/\.lwf$/.test(b)||(b+=".lwf"),b}var c=a;return a.indexOf("/")>=0&&(c=a.substring(a.lastIndexOf("/")+1)),a+"/_/"+c+".lwf"},b}();a.LwfSettings=b}(LwfPlayer||(LwfPlayer={}));var LwfPlayer;!function(a){var b=function(){function a(){this.renderer="canvas",this.debug=!0,this.targetStage=null}return a}();a.PlayerSettings=b}(LwfPlayer||(LwfPlayer={}));var LwfPlayer;!function(a){"use strict";a.Util.initUtil();var b=function(){function b(b,c){this.lwf=null,this.cache=null,this.playerSettings=null,this.lwfSettings=new a.LwfSettings,this.stageContractor=null,this.coordinator=null,this.rendererSelector=new a.RendererSelector,this.inputQueue=[],this.requests=[],this.from=global.performance.now(),this.pausing=!1,this.destroyed=!1,this.playerSettings=b,this.lwfSettings.prepareLwfSettings(this,c),void 0!==this.playerSettings.renderer&&null!==this.playerSettings.renderer&&this.rendererSelector.setRenderer(this.playerSettings.renderer),this.stageContractor=new a.StageContractor(this),this.stageContractor.createScreenStage(this.rendererSelector),this.coordinator=new a.Coordinator(this.stageContractor),this.lwfSettings.stage=this.stageContractor.getScreenStage(),this.restraint(),this.initLwf()}return b.prototype.play=function(){var a=this;this.stageContractor.addEventListeners(),this.lwfSettings.onload=function(b){null!==b?(a.lwf=b,a.exec()):a.handleLoadError()},this.cache.loadLWF(this.lwfSettings)},b.prototype.pause=function(){this.pausing=!0},b.prototype.resume=function(){this.pausing=!1},b.prototype.destroy=function(){this.destroyed=!0},b.prototype.getCoordinator=function(){return this.coordinator},b.prototype.getPlayerSettings=function(){return this.playerSettings},b.prototype.getLwfSettings=function(){return this.lwfSettings},b.prototype.getRendererSelector=function(){return this.rendererSelector},b.prototype.getStageContractor=function(){return this.stageContractor},b.prototype.loadLWF=function(a,b,c,d,e){var f=this.lwfSettings.prepareChildLwfSettings(a,b,c,d),g=this;f.onload=function(a){return a?e(null,a):(g.handleLoadError(),e(f.error,a))},this.cache.loadLWF(f)},b.prototype.handleLoadError=function(){this.lwfSettings.handler&&"function"==typeof this.lwfSettings.handler.loadError&&this.lwfSettings.handler.loadError(this.lwfSettings.error),console.error("[LWF] load error: %o",this.lwfSettings.error)},b.prototype.handleException=function(a){this.lwfSettings.handler&&"function"==typeof this.lwfSettings.handler.exception&&this.lwfSettings.handler.exception(a),console.error("[LWF] load Exception: %o",a)},b.prototype.exec=function(){var a=this;try{if(this.destroyed)return void this.destroyLwf();if(null!==this.lwf&&!this.pausing){for(var b=0;b<this.inputQueue.length;b++)this.inputQueue[b].apply(this);this.stageContractor.changeStageSize(this.lwf.width,this.lwf.height),this.renderLwf()}this.inputQueue=[],global.requestAnimationFrame(function(){a.exec()})}catch(c){a.handleException(c)}},b.prototype.initLwf=function(){try{switch(this.rendererSelector.getRenderer()){case a.RendererSelector.canvasRenderer:global.LWF.useCanvasRenderer();break;case a.RendererSelector.webkitCSSRenderer:global.LWF.useWebkitCSSRenderer();break;case a.RendererSelector.webGLRenderer:global.LWF.useWebGLRenderer();break;default:throw new Error("not supported renderer")}this.cache=global.LWF.ResourceCache.get()}catch(b){this.handleException(b)}},b.prototype.renderLwf=function(){var b=global.performance.now(),c=b-this.from,d=this.stageContractor.getScreenStageWidth(),e=this.stageContractor.getScreenStageHeight();this.from=b,this.lwf.property.clear(),this.lwfSettings.fitForWidth?this.lwf.fitForWidth(d,e):this.lwf.fitForHeight(d,e),this.getRendererSelector().getRenderer()===a.RendererSelector.webkitCSSRenderer&&this.lwf.setTextScale(this.getStageContractor().getDevicePixelRatio()),this.lwf.property.moveTo(0,0),this.lwf.exec(c/1e3),this.lwf.render(),this.playerSettings.debug&&this.stageContractor.viewDebugInfo()},b.prototype.destroyLwf=function(){null!==this.lwf&&(this.stageContractor.removeEventListeners(),this.lwf.destroy(),this.cache=null,this.lwf=null,console.log("destroy LWF.")),console.log("LWF is destroyed.")},b.prototype.inputPoint=function(a){var b=this.coordinator.getInputPoint(a);this.lwf.inputPoint(b.getX(),b.getY())},b.prototype.inputPress=function(a){this.inputPoint(a),this.lwf.inputPress()},b.prototype.onMove=function(a){this.inputQueue.push(function(){this.inputPoint(a)})},b.prototype.onPress=function(a){this.inputQueue.push(function(){this.inputPress(a)})},b.prototype.onRelease=function(){this.inputQueue.push(function(){this.lwf.inputRelease()})},b.prototype.restraint=function(){var a=function(a,b){return function(){a.apply(b,arguments)}};this.onRelease=a(this.onRelease,this),this.onPress=a(this.onPress,this),this.onMove=a(this.onMove,this)},b}();a.Player=b}(LwfPlayer||(LwfPlayer={}));