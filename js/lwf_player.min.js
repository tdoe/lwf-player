var LwfPlayer;!function(a){"use strict";var b=function(){function a(){}return a.initUtil=function(){if(global.performance.now=global.performance.now||global.performance.webkitNow||global.performance.mozNow||global.performance.oNow||global.performance.msNow||Date.now,global.requestAnimationFrame=global.requestAnimationFrame||global.webkitRequestAnimationFrame||global.mozRequestAnimationFrame||global.oRequestAnimationFrame||global.msRequestAnimationFrame,void 0===global.requestAnimationFrame||/iP(ad|hone|od).*OS 6/.test(a.ua)){var b=1e3/60,c=global.performance.now();global.requestAnimationFrame=function(a){var d=global.performance.now(),e=d-c,f=b-(e>b?e%b:e);return setTimeout(function(){c=global.performance.now(),a()},f)}}},a.ua=navigator.userAgent,a.isiOS=/iP(ad|hone|od)/.test(a.ua),a.isAndroid=/Android/.test(a.ua),a.isSp=a.isiOS||a.isAndroid,a.isChrome=/Chrome/.test(a.ua),a.isTouchEventEnabled=a.isSp,a.useWebWorker=!a.isAndroid||a.isChrome,a.debugInfoElementId=0,a}();a.Util=b}(LwfPlayer||(LwfPlayer={}));var LwfPlayer;!function(a){var b=function(){function b(){this.x=0,this.y=0,this.stageScale=1}return b.prototype.getInputPoint=function(b,c,d){d&&b.preventDefault();var e=c.getBoundingClientRect();if(a.Util.isTouchEventEnabled){var f=b.touches[0];this.x=f.pageX,this.y=f.pageY}else this.x=b.clientX,this.y=b.clientY;return this.x-=e.left,this.y-=e.top,a.Util.isSp&&(this.x-=global.scrollX,this.y-=global.scrollY),this.x/=this.stageScale,this.y/=this.stageScale,this},b.prototype.setStageScale=function(a){this.stageScale=a},b.prototype.getX=function(){return this.x},b.prototype.getY=function(){return this.y},b}();a.Coordinator=b}(LwfPlayer||(LwfPlayer={}));var LwfPlayer;!function(a){"use strict";var b=function(){function a(){}return a}();a.LwfSettings=b}(LwfPlayer||(LwfPlayer={}));var LwfPlayer;!function(a){var b=function(){function a(){this.renderer="canvas",this.debug=!0,this.targetStage=null}return a}();a.PlayerSettings=b}(LwfPlayer||(LwfPlayer={}));var LwfPlayer;!function(a){"use strict";var b=function(){function b(){this.useWebGL=!1,this.renderer=this.autoSelectRenderer_()}return b.prototype.getDevicePixelRatio=function(){var c=window.devicePixelRatio;return this.renderer===b.webkitCSSRenderer&&(c=1),this.renderer===b.webGLRenderer&&/ F-/.test(a.Util.ua)&&(c=2),c},b.prototype.getRenderer=function(){return this.renderer},b.prototype.setRenderer=function(a){this.renderer=b.canvasRenderer,a===b.rendererWebkitCSS?this.renderer=b.webkitCSSRenderer:a===b.rendererWebGL&&(this.renderer=b.webGLRenderer)},b.prototype.autoSelectRenderer_=function(){var c=a.Util.ua;if(this.useWebGL)for(var d,e=document.createElement("canvas"),f=["webgl","experimental-webgl","moz-webgl","webkit-3d"],g=0;g<f.length;g++)if(d=e.getContext(f[g]))return b.webGLRenderer;return/iP(ad|hone|od).*OS 4/.test(c)?b.webkitCSSRenderer:/Android 2\.1/.test(c)||/Android 2\.3\.[5-7]/.test(c)?b.webkitCSSRenderer:/Android 4/.test(c)?/Chrome/.test(c)?b.canvasRenderer:b.webkitCSSRenderer:b.canvasRenderer},b.webkitCSSRenderer="useWebkitCSSRenderer",b.webGLRenderer="useWebGLRenderer",b.canvasRenderer="useCanvasRenderer",b.rendererWebkitCSS="webkitcss",b.rendererWebGL="webgl",b.rendererCanvas="canvas",b}();a.RendererSelector=b}(LwfPlayer||(LwfPlayer={}));var LwfPlayer;!function(a){var b=function(){function b(a){if(this.player=null,this.targetStage=null,this.screenStage=null,this.stageScale=1,this.debugInfo=null,this.from=global.performance.now(),this.currentFPS=0,this.execCount=0,this.player=a,this.targetStage=this.player.getPlayerSettings().targetStage,void 0===this.targetStage||null===this.targetStage)throw new Error;this.eventStage=document.createElement("div"),this.targetStage.appendChild(this.eventStage),this.devicePixelRatio=this.player.getRendererSelector().getDevicePixelRatio()}return b.prototype.getScreenStage=function(){return this.screenStage},b.prototype.getScreenStageWidth=function(){return+this.screenStage.getAttribute("width")},b.prototype.getScreenStageHeight=function(){return+this.screenStage.getAttribute("height")},b.prototype.changeStageSize=function(a,b){var c=0,d=0,e=~~a*this.devicePixelRatio,f=~~b*this.devicePixelRatio;a>global.innerWidth&&(a=global.innerWidth),b>global.innerHeight&&(b=global.innerHeight),this.player.getLwfSettings().fitForWidth?(c=Math.round(a),d=Math.round(a*b/a),this.stageScale=c/e):(c=Math.round(b*a/b),d=Math.round(b),this.stageScale=d/f),this.player.getCoordinator().setStageScale(this.stageScale),this.screenStage.style.width=c+"px",this.screenStage.style.height=d+"px",this.screenStage.setAttribute("width",e+""),this.screenStage.setAttribute("height",f+"")},b.prototype.removeEventListeners=function(){a.Util.isTouchEventEnabled?(this.screenStage.removeEventListener("touchstart",this.player.onPress,!1),this.screenStage.removeEventListener("touchmove",this.player.onMove,!1),this.screenStage.removeEventListener("touchend",this.player.onRelease,!1)):(this.screenStage.removeEventListener("mousedown",this.player.onPress,!1),this.screenStage.removeEventListener("mousemove",this.player.onMove,!1),this.screenStage.removeEventListener("mouseup",this.player.onRelease,!1))},b.prototype.addEventListeners=function(){a.Util.isTouchEventEnabled?(this.screenStage.addEventListener("touchstart",this.player.onPress,!1),this.screenStage.addEventListener("touchmove",this.player.onMove,!1),this.screenStage.addEventListener("touchend",this.player.onRelease,!1)):(this.screenStage.addEventListener("mousedown",this.player.onPress,!1),this.screenStage.addEventListener("mousemove",this.player.onMove,!1),this.screenStage.addEventListener("mouseup",this.player.onRelease,!1))},b.prototype.createScreenStage=function(b){this.screenStage=document.createElement(b.getRenderer()===a.RendererSelector.canvasRenderer||b.getRenderer()===a.RendererSelector.webGLRenderer?"canvas":"div"),this.screenStage.style.position="relative",this.screenStage.style.top="0px",this.screenStage.style.left="0px",this.screenStage.style.zIndex=this.targetStage.style.zIndex+1,b.getRenderer()===a.RendererSelector.webkitCSSRenderer&&/Android 2\.3\.[5-7]/.test(a.Util.ua)&&/SH/.test(a.Util.ua)&&(this.screenStage.style.opacity="0.9999"),this.targetStage.appendChild(this.screenStage)},b.prototype.viewDebugInfo=function(){if(null==this.debugInfo&&(this.debugInfo=document.createElement("div"),this.debugInfo.style.position="absolute",this.debugInfo.style.top="0px",this.debugInfo.style.left="0px",this.debugInfo.style.zIndex="9999",this.debugInfo.style.color="red",this.debugInfo.className="lwfPlayerDebugInfo",this.targetStage.appendChild(this.debugInfo)),this.execCount%60===0){var a=global.performance.now();this.currentFPS=Math.round(6e4/(a-this.from)),this.from=a,this.execCount=0}var b=this.player.getCoordinator().getX(),c=this.player.getCoordinator().getY();this.execCount++,this.debugInfo.innerHTML=this.player.getRendererSelector().getRenderer()+" "+this.currentFPS+"fps X:"+b+" Y:"+c},b}();a.StageContractor=b}(LwfPlayer||(LwfPlayer={}));var LwfPlayer;!function(a){"use strict";a.Util.initUtil();var b=function(){function b(b,c){this.lwf=null,this.playerSettings=null,this.lwfSettings=null,this.stageContractor=null,this.coordinator=new a.Coordinator,this.rendererSelector=new a.RendererSelector,this.inputQueue=[],this.requests=[],this.from=global.performance.now(),this.isPreventDefaultEnabled=!1,this.pausing=!1,this.destroyed=!1,this.playerSettings=b,this.lwfSettings=c,this.restraint(),this.initLwf(),this.stageContractor=new a.StageContractor(this),this.stageContractor.createScreenStage(this.rendererSelector),this.validateLwfSetting()}return b.prototype.play=function(){var a=this;this.stageContractor.addEventListeners(),this.requestLWF(function(b){a.lwf=b}),this.loadLWFs(function(b){null===b?a.exec():a.handleLoadError()})},b.prototype.pause=function(){this.pausing=!0},b.prototype.resume=function(){this.pausing=!1},b.prototype.destroy=function(){this.destroyed=!0},b.prototype.getCoordinator=function(){return this.coordinator},b.prototype.getPlayerSettings=function(){return this.playerSettings},b.prototype.getLwfSettings=function(){return this.lwfSettings},b.prototype.getRendererSelector=function(){return this.rendererSelector},b.prototype.requestLWF=function(a){this.lwfSettings.onload=a,this.requests.push(this.lwfSettings)},b.prototype.loadLWFs=function(a){this.cache.loadLWFs(this.requests,a),this.requests=[]},b.prototype.loadLWF=function(a,b,c,d,e){for(var f in d)d.hasOwnProperty(f)&&(this.lwfSettings.privateData[f]=d[f]);d.hasOwnProperty("imageMap")&&(this.lwfSettings.imageMap=this.getImageMapper(d.imageMap));var g=this;this.lwfSettings.onload=function(a){return a?e(null,a):(g.handleLoadError(),e(this.error,a))},this.lwfSettings.imagePrefix=void 0,this.lwfSettings.parentLWF=a,this.lwfSettings.active=!1,this.lwfSettings.fitForHeight=this.lwfSettings.fitForWidth=!1,this.lwfSettings.lwf=this.getLwfPath(b),this.cache.loadLWF(this.lwfSettings)},b.prototype.handleLoadError=function(){this.lwfSettings.handler&&"function"==typeof this.lwfSettings.handler.loadError&&this.lwfSettings.handler.loadError(this.lwfSettings.error),console.error("[LWF] load error: %o",this.lwfSettings.error)},b.prototype.handleException=function(a){this.lwfSettings.handler&&"function"==typeof this.lwfSettings.handler.exception&&this.lwfSettings.handler.exception(a),console.error("[LWF] load Exception: %o",a)},b.prototype.getLwfPath=function(a){if(void 0!==this.lwfSettings.lwfMap&&"object"==typeof this.lwfSettings.lwfMap){var b=this.lwfSettings.lwfMap[a];return/\.lwf$/.test(b)||(b+=".lwf"),b}var c=a;return a.indexOf("/")>=0&&(c=a.substring(a.lastIndexOf("/")+1)),a+"/_/"+c+".lwf"},b.prototype.getImageMapper=function(a){return"function"==typeof a?a:function(b){if(a&&a.hasOwnProperty(b))return a[b];if(0===b.indexOf("lwf_")){var c=this.lwf.slice(0,this.lwf.lastIndexOf("/")+1);return"lwf/"+c+b}return 0===b.indexOf("param_")?(console.error("[LWF] error: no imageMap setting for %s, use dummy image.",b),"lwf/dummy.png"):b.replace(/_/g,"/")}},b.prototype.exec=function(){var a=this;try{if(this.destroyed)return void this.destroyLwf();if(null!=this.lwf&&!this.pausing){for(var b=0;b<this.inputQueue.length;b++)this.inputQueue[b]();this.stageContractor.changeStageSize(this.lwf.width,this.lwf.height),this.renderLwf()}this.inputQueue=[],global.requestAnimationFrame(function(){a.exec()})}catch(c){a.handleException(c)}},b.prototype.initLwf=function(){(void 0!==this.playerSettings.renderer||null!==this.playerSettings.renderer)&&this.rendererSelector.setRenderer(this.playerSettings.renderer);try{switch(this.rendererSelector.getRenderer()){case a.RendererSelector.canvasRenderer:global.LWF.useCanvasRenderer();break;case a.RendererSelector.webkitCSSRenderer:global.LWF.useWebkitCSSRenderer();break;case a.RendererSelector.webGLRenderer:global.LWF.useWebGLRenderer();break;default:throw new Error("not supported renderer")}this.cache=global.LWF.ResourceCache.get()}catch(b){this.handleException(b)}},b.prototype.renderLwf=function(){var a=global.performance.now(),b=a-this.from,c=this.stageContractor.getScreenStageWidth(),d=this.stageContractor.getScreenStageHeight();this.from=a,this.lwf.property.clear(),this.lwfSettings.fitForWidth?this.lwf.fitForWidth(c,d):this.lwf.fitForHeight(c,d),this.lwf.exec(b/1e3),this.lwf.render(),this.playerSettings.debug&&this.stageContractor.viewDebugInfo()},b.prototype.destroyLwf=function(){null!==this.lwf&&(this.stageContractor.removeEventListeners(),this.lwf.destroy(),this.cache=null,this.lwf=null,console.log("destroy LWF.")),console.log("LWF is destroyed.")},b.prototype.validateLwfSetting=function(){void 0===this.lwfSettings.privateData&&(this.lwfSettings.privateData={}),void 0===this.lwfSettings.useBackgroundColor&&(this.lwfSettings.useBackgroundColor=!0),this.lwfSettings.stage=this.stageContractor.getScreenStage(),this.lwfSettings.imageMap=this.getImageMapper(this.lwfSettings.imageMap),this.lwfSettings.privateData.lwfLoader=this},b.prototype.inputPoint=function(a){var b=this.coordinator.getInputPoint(a,this.stageContractor.getScreenStage(),this.isPreventDefaultEnabled);this.lwf.inputPoint(b.getX(),b.getY())},b.prototype.inputPress=function(a){this.inputPoint(a),this.lwf.inputPress()},b.prototype.inputRelease=function(a){this.inputPoint(a),this.lwf.inputRelease()},b.prototype.onMove=function(a){var b=this;this.inputQueue.push(function(){b.inputPoint(a)})},b.prototype.onPress=function(a){var b=this;this.inputQueue.push(function(){b.inputPress(a)})},b.prototype.onRelease=function(a){var b=this;this.inputQueue.push(function(){b.inputRelease(a)})},b.prototype.restraint=function(){var a=function(a,b){return function(){a.apply(b,arguments)}};this.onRelease=a(this.onRelease,this),this.onPress=a(this.onPress,this),this.onMove=a(this.onMove,this)},b}();a.Player=b}(LwfPlayer||(LwfPlayer={}));